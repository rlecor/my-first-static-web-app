<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stopwatch</title>
  <style>
    :root{
      --bg:#ffffff;--fg:#111111;--card:#f3f4f6;--accent:#0b84ff;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b0b0c; --fg:#e6e7e8; --card:#121214; --accent:#4ea6ff }
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg)}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:2rem}
    .card{background:var(--card);padding:2rem;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);width:min(520px,96%);text-align:center}

    .time{font-size:3.25rem;font-weight:600;letter-spacing:0.02em;margin:0.25rem 0}
    .controls{display:flex;gap:0.5rem;margin-top:1rem;justify-content:center;flex-wrap:wrap}
    button{appearance:none;border:0;padding:0.6rem 1rem;border-radius:8px;font-weight:600;cursor:pointer;background:transparent}
    .btn-primary{background:var(--accent);color:#fff}
    .btn-ghost{background:transparent;border:1px solid rgba(0,0,0,0.08)}
    @media (prefers-color-scheme: dark){
      .btn-ghost{border-color:rgba(255,255,255,0.06)}
    }
    .laps{max-height:160px;overflow:auto;text-align:left;margin-top:1rem;padding-top:1rem;border-top:1px dashed rgba(0,0,0,0.06)}
    .lap{padding:0.35rem 0;display:flex;justify-content:space-between;font-family:monospace}
    .hint{opacity:0.7;font-size:0.9rem;margin-top:0.5rem}

    /* Focus styles */
    button:focus{outline:3px solid color-mix(in srgb, var(--accent) 20%, transparent);outline-offset:2px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="Stopwatch">
      <h1 style="margin:0;font-size:1.125rem;font-weight:700">Stopwatch</h1>
      <p class="time" id="display" aria-live="polite">0:00:00.00</p>

      <div class="controls">
        <button id="startStop" class="btn-primary">Start</button>
        <button id="lapBtn" class="btn-ghost">Lap</button>
        <button id="resetBtn" class="btn-ghost">Reset</button>
      </div>

      <div class="laps" id="laps" aria-label="Laps"></div>
      <div class="hint">Keyboard: Space = Start/Stop · R = Reset · L = Lap</div>
    </div>
  </div>

  <script>
    // Accurate stopwatch using performance.now() and requestAnimationFrame
    const display = document.getElementById('display');
    const startStopBtn = document.getElementById('startStop');
    const resetBtn = document.getElementById('resetBtn');
    const lapBtn = document.getElementById('lapBtn');
    const lapsEl = document.getElementById('laps');

    let running = false;
    let startTime = 0;       // timestamp when started
    let elapsedBefore = 0;   // ms accumulated before current run
    let rafId = null;

    function pad(n, digits=2){ return String(n).padStart(digits,'0'); }
    function formatTime(ms){
      const totalCs = Math.floor(ms/10); // centiseconds
      const cs = totalCs % 100;
      const totalSeconds = Math.floor(ms/1000);
      const s = totalSeconds % 60;
      const totalMinutes = Math.floor(totalSeconds/60);
      const m = totalMinutes % 60;
      const h = Math.floor(totalMinutes/60);
      return `${h}:${pad(m)}:${pad(s)}.${pad(cs,2)}`;
    }

    function update(){
      const now = performance.now();
      const elapsed = elapsedBefore + (running ? now - startTime : 0);
      display.textContent = formatTime(Math.floor(elapsed));
      rafId = requestAnimationFrame(update);
    }

    function start(){
      if (running) return;
      running = true;
      startTime = performance.now();
      startStopBtn.textContent = 'Stop';
      startStopBtn.classList.remove('btn-primary');
      startStopBtn.classList.add('btn-ghost');
      if (!rafId) rafId = requestAnimationFrame(update);
    }
    function stop(){
      if (!running) return;
      running = false;
      const now = performance.now();
      elapsedBefore += now - startTime;
      startStopBtn.textContent = 'Start';
      startStopBtn.classList.remove('btn-ghost');
      startStopBtn.classList.add('btn-primary');
    }

    function reset(){
      running = false;
      cancelAnimationFrame(rafId);
      rafId = null;
      startTime = 0;
      elapsedBefore = 0;
      display.textContent = '0:00:00.00';
      startStopBtn.textContent = 'Start';
      startStopBtn.classList.remove('btn-ghost');
      startStopBtn.classList.add('btn-primary');
      lapsEl.innerHTML = '';
    }

    function addLap(){
      const now = performance.now();
      const elapsed = elapsedBefore + (running ? now - startTime : 0);
      const li = document.createElement('div');
      li.className = 'lap';
      li.innerHTML = `<div>Lap</div><div>${formatTime(Math.floor(elapsed))}</div>`;
      lapsEl.prepend(li);
    }

    // Button events
    startStopBtn.addEventListener('click', ()=> running ? stop() : start());
    resetBtn.addEventListener('click', reset);
    lapBtn.addEventListener('click', addLap);

    // Keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if (e.code === 'Space'){
        e.preventDefault();
        running ? stop() : start();
      } else if (e.key.toLowerCase() === 'r'){
        reset();
      } else if (e.key.toLowerCase() === 'l'){
        addLap();
      }
    });

    // Start RAF so elapsed shows correctly even when stopped (keeps display responsive)
    if (!rafId) rafId = requestAnimationFrame(update);
  </script>
</body>
</html>
